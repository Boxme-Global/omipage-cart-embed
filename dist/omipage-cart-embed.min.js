"use strict";!function(t){class e{constructor(t,e,n,a,i,r){this.sku=t,this.name=e,this.price=n,this.discounted_price=a,this.image=i,this.quantity=r,this.added_time=parseInt((new Date).getTime()/1e3)}total_amount(){return self.quantity*self.price}increase_quantity(t=1){this.quantity+=t}set_quantity(t){this.quantity=t}decrease_quantity(t=1){this.quantity-=t}}t.Cart=class{constructor(){this.items=[],this.load_cart_from_storage()}uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}generate_cart_id(){this.omp_cart_id=this.uuidv4(),t.localStorage.setItem("omp_cart_id",this.omp_cart_id)}remove_item(t){var e=this.find(t);if(e){var n=this.items.indexOf(e);this.items.splice(n,1)}this.save_cart()}set_quantity(e,n){var a=this.find(e);if(a){var i=this.items.indexOf(a);return"decrease"==n-a.quantity<=0?t.dataLayer&&(t.dataLayer.push({ecommerce:null}),t.dataLayer.push({event:"addToCart",ecommerce:{currencyCode:"VND",add:{products:[{name:a.product_name,id:a.sku,price:a.discounted_price,variant:a.product_name,quantity:-(n-a.quantity)}]}}})):t.dataLayer&&(t.dataLayer.push({ecommerce:null}),t.dataLayer.push({event:"addToCart",ecommerce:{currencyCode:"VND",add:{products:[{name:a.product_name,id:a.sku,price:a.discounted_price,variant:a.product_name,quantity:n-a.quantity}]}}})),a.set_quantity(n),this.items[i]=a,void this.save_cart()}}increase_sku_quantity(e,n=1){var a=this.find(e);if(a){t.dataLayer&&(t.dataLayer.push({ecommerce:null}),t.dataLayer.push({event:"addToCart",ecommerce:{currencyCode:"VND",add:{products:[{name:a.product_name,id:a.sku,price:a.discounted_price,variant:a.product_name,quantity:a.quantity}]}}}));var i=this.items.indexOf(a);return a.increase_quantity(n),this.items[i]=a,void this.save_cart()}console.log("not found item in the cart")}decrease_sku_quantity(e,n=1){var a=this.find(e);if(a){t.dataLayer&&(t.dataLayer.push({ecommerce:null}),t.dataLayer.push({event:"removeFromCart",ecommerce:{currencyCode:"VND",add:{products:[{name:a.product_name,id:a.sku,price:a.discounted_price,variant:a.product_name,quantity:a.quantity}]}}}));var i=this.items.indexOf(a);return a.decrease_quantity(n),a.quantity<=0?this.items.splice(i,1):this.items[i]=a,void this.save_cart()}console.log("not found item in the cart")}add_item_to_cart(e){t.dataLayer&&(t.dataLayer.push({ecommerce:null}),t.dataLayer.push({event:"addToCart",ecommerce:{currencyCode:"VND",add:{products:[{name:e.product_name,id:e.sku,price:e.discounted_price,variant:e.product_name,quantity:e.quantity}]}}}));var n=this.find(e.sku);if(!n)return this.items.push(e),void this.save_cart();var a=this.items.indexOf(n);n.increase_quantity(e.quantity),this.items[a]=n,this.save_cart()}find(t){return this.items.find((e=>e.sku==t))}total_quantity(){var t=0;return this.items.forEach(((e,n)=>{t+=e.quantity})),t}has(t){return null!=this.find(t)}clear_cart(){this.generate_cart_id(),this.items=[],this.save_cart()}save_cart(){t.localStorage.setItem("omp_cart",JSON.stringify(this.items)),document.dispatchEvent(new CustomEvent("cart_changed",{bubbles:!0},{detail:"Event change cart"}))}load_cart_from_storage(){this.items=[];var n=JSON.parse(t.localStorage.getItem("omp_cart"));if(n)for(var a in n){var i=new e(n[a].sku,n[a].name,Number(n[a].price),Number(n[a].discounted_price),n[a].image,Number(n[a].quantity));this.items.push(i)}this.omp_cart_id=t.localStorage.getItem("omp_cart_id"),this.omp_cart_id||this.generate_cart_id()}},t.Omipage=class{constructor(t){this.cart=t,this.cart_quantity_els=document.querySelectorAll('[data-cart-quantity="true"]'),this.add_to_cart_btns=document.querySelectorAll('[data-action="add_to_cart"]'),this.checkout_btns=document.querySelectorAll('[data-action="checkout"]'),this.load_page_key(),this.load_page_title(),this.load_utm_tag(),this.load_referral(),this.render_popup_style(),this.create_popup_elements(),this.render_popup()}create_popup_elements(){var t=document.createElement("DIV");t.setAttribute("id","omp-cart-popup"),document.body.appendChild(t)}open_cart_popup(){this.render_popup(),document.getElementById("omp-cart-popup").setAttribute("class","active")}close_cart_popup(){document.getElementById("omp-cart-popup").classList.remove("active")}render_popup_style(){var t=document.createElement("style");t.innerText='\n                #omp-cart-popup{\n                    font-family: -apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;\n                    display: none; /* Hidden by default */\n                    position: fixed; /* Stay in place */\n                    z-index: 1; /* Sit on top */\n                    left: 0;\n                    top: 0;\n                    width: 100%; /* Full width */\n                    height: 100%; /* Full height */\n                    overflow: auto; /* Enable scroll if needed */\n                    background-color: rgb(0,0,0); /* Fallback color */\n                    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */ \n                }\n                #omp-cart-popup.active{\n                    display:block;\n                }\n                .omp-cart-title{\n                    font-size: 22px;\n                }\n                .omp-cart-popup-content{\n                        position: relative;\n                        background-color: #fefefe;\n                        margin: 13% auto; /* 15% from the top and centered */\n                        padding: 20px;\n                        border: 1px solid #888;\n                        width: 80%; /* Could be more or less, depending on screen size */\n                        max-width: 700px\n                }\n                .omp-cart-row{\n                    display: block;\n                    margin: 5px 0px;\n                    border-bottom: 1px solid #f2f2f2;\n                    padding-bottom: 10px;\n                }\n                .omp-cart-row:last-child{\n                    border-bottom: none;\n                }\n                .omp-cart-close{\n                    position: absolute;\n                    right: 20px;\n                    top: 20px;\n                    border: 0;\n                }\n                .omp-cart-close button{\n                    background: none;\n                    border: none;\n                    color: #333;\n                }\n\n                .omp-cart-close button:hover{\n                    cursor: pointer;\n                }\n                .omp-text-center{\n                    text-align: center;\n                }\n                .omp-cart-image{\n                    width: 50px!important;\n                    height: 50px;\n                    float: left;\n                }\n                .omp-cart-image img{\n                    width: 50px;\n                    height: 50px;\n                    border-radius: 3px;\n                }\n                .omp-cart-product-name{\n                    font-size: 13px;\n                    padding-left:5px;\n                    font-weight:400;\n                    min-width: 300px;\n                }\n                .omp-cart-quantity-content{\n                    display: -webkit-inline-flex;\n                    display: inline-flex;\n                }\n                .omp-cart-quantity-content input{\n                    width: 50px;\n                    height: 30px;\n                    text-align: center;\n                    border: 1px solid #cdcdcd;\n                    border-radius: 0px;\n                    \n                }\n                .omp-cart-quantity-content button{\n                    border: 1px solid #cdcdcd;\n                    cursor: pointer;\n                    text-align: center;\n                    width: 21px;\n                    height: 30px;\n                    background: #cdcdcd;\n                    padding: 8px!important;\n                    border-radius: 0;\n\n                }\n                .omp-cart-quantity-content button:active {\n                    height: 29px;\n                }\n\n                \n                .omp-cart-price{\n                    text-align: right;\n                    color:red;\n                    width: 180px;\n                }\n                .omp-cart-remove-item button{\n                    border: 1px solid #cdcdcd;\n                    cursor: pointer;\n                    text-align: center;\n                    width: 23px;\n                    height: 30px;\n                    margin-left: 5px;\n                    font-size:11px;\n                    background: #cdcdcd;\n                    padding: 8px!important;\n\n                }\n                .omp-cart-remove-item button:active {\n                    height: 29px;\n                }\n                .omp-cart-action button {\n                    height: 45px;\n                    background: #27ae60;\n                    color: white;\n                    border: none;\n                    border-radius: 3px;\n                    width: 100%;\n                    margin-top: 28px;\n                    font-size: 18px;\n                    cursor: pointer;\n                }\n                .omp-cart-action button:active{\n                    opacity: 0.9;\n                }\n\n                .omipage-checkout__products-item {\n                    display: grid;\n                    grid-template-columns: 5rem auto 8rem;\n                    grid-template-areas:\n                        "thumbnail name discounted-price"\n                        "thumbnail quantity quantity";\n                    grid-column-gap: 0.75rem;\n                }\n            \n                    .omipage-checkout__products-item--thumbnail {\n                        grid-area: thumbnail;\n                        align-self: center;\n                        width: 5rem;\n                        max-height: 5rem;\n                        border-radius: 3px;\n                    }\n            \n                    .omipage-checkout__products-item--name {\n                        grid-area: name;\n                        align-self: center;\n                        white-space: normal;\n                        word-break: break-word;\n                        font-size:13px;\n                    }\n                    .omipage-checkout__products-item--name .item-name__group--product-name{\n                        overflow: hidden;\n                        text-overflow: ellipsis;\n                        display: -webkit-box;\n                        -webkit-line-clamp: 2; /* number of lines to show */\n                        -webkit-box-orient: vertical;\n                        font-weight: 400;\n                     \n                    }\n\n                    .omipage-checkout__products-item--discounted-price {\n                        grid-area: discounted-price;\n                        align-self: center;\n                        white-space: normal;\n                        word-break: break-word;\n                        color:red;\n                    }\n            \n                    .omipage-checkout__products-item--quantity {\n                        grid-area: quantity;\n                        align-self: center;\n                    }\n                }\n\n                /* When the browser is at least 600px and above */\n                /* Portrait and Landscape */\n                @media (max-width: 767.98px) { \n                    .omipage-checkout__products-item--thumbnail {\n                        width: 3rem;\n                    }\n                    .omipage-checkout__products-item {\n                        grid-template-columns: 3rem auto 6rem;\n                    }\n                    .omp-cart-popup-content{\n                        width: 95%\n                    }\n                }\n\n\n            ',document.head.appendChild(t)}render_popup(){var t=document.getElementById("omp-cart-popup");if(0==this.cart.items.length)return e='\n                    <div class="omp-cart-popup-content">\n                        <div class="omp-cart-close" onclick="omipage.close_cart_popup()"><button>X</button></div>\n                        <p class ="omp-text-center ">\n                            <img src="https://storage.googleapis.com/omisell-cloud/omipage/cart_empty.png" width="300px" alt="" class="mx-auto">\n                        </p>\n                        <p class ="omp-text-center ">\n                            Giỏ hàng của bạn trống\n                        </p>\n                        \n                        \n                        <div class="omp-cart-action">\n                            <button onclick="omipage.close_cart_popup()">Quay lại</button>\n                       </div>\n                   </div>\n                ',void(t.innerHTML=e);var e="";this.cart.items.forEach((function(t){var n='<div  class="omp-cart-row" id="omp-cart-row-'+t.sku+'">\n                    <div  class="col-12 omipage-checkout__products-item"><img \n                            alt="Product image" class="omipage-checkout__products-item--thumbnail"\n                            src="'+t.image+'" onerror="this.src=\'https://storage.googleapis.com/omisell-cloud/omipage/product.png\'">\n                        <div  class="omipage-checkout__products-item--name">\n                            <div  class="item-name__group">\n                                <div  class="item-name__group--product-name" title="'+t.name+'"> '+t.name+' </div>\n                                <div  class="item-name__group--delete-button text-danger pointer"><i\n                                        class="bi bi-trash"></i></div>\n                            </div>\n                        </div>\n                        <div  class="omipage-checkout__products-item--discounted-price text-danger"> <span id="omp-cart-price-'+t.sku+'">'+(t.discounted_price*t.quantity).toLocaleString()+' VNĐ</span>\n                        </div>\n                        <div class="omipage-checkout__products-item--quantity input-group">\n                            <div class="omp-cart-quantity-content">\n                                <button onclick="javascript: omipage.decrease_quantity(\''+t.sku+'\', 1);" type="button"><span>-</span></button>\n                                <input id="omp-cart-quantity-input-'+t.sku+'" type="number" min="1" value="'+t.quantity+'" oninput="javascript: omipage.set_quantity(\''+t.sku+'\', this.value);">\n                                <button type="button" onclick="javascript: omipage.increase_quantity(\''+t.sku+"', 1);\"><span>+</span></button>\n                            </div>\n                        </div>\n                    </div>\n                </div>";e+=n})),t.innerHTML='\n                <div class="omp-cart-popup-content">\n\n                    <div class="omp-cart-close" onclick="omipage.close_cart_popup()"><button>X</button></div>\n                    <p class ="omp-text-center omp-cart-title">Giỏ hàng</p>\n                  \n            '+e+'\n                        \n                    <div class="omp-cart-action">\n                     <a href="/checkout" onMouseOver="this.style.cursor=\'pointer\'"><button data-action="checkout">THANH TOÁN NGAY</button></a>\n                    </div>\n                </div>\n            '}display_quantity_to_view(){var t=this;this.cart_quantity_els.forEach((e=>{e.innerHTML=t.cart.total_quantity()}))}binding_cart_quantity(){var t=this;t.display_quantity_to_view(),document.addEventListener("cart_changed",(e=>{t.display_quantity_to_view()}))}binding_add_to_cart_button(){var n=this,a=function(a){var i,r,o,c,s,d,u,p=this,m="checkout"==p.getAttribute("data-action");p.getAttribute("data-action");if(i=p.getAttribute("data-name"),r=p.getAttribute("data-sku"),o=Number(p.getAttribute("data-quantity")),c=Number(p.getAttribute("data-price")),s=Number(p.getAttribute("data-discounted-price")),d=p.getAttribute("data-image"),u=p.getAttribute("data-append-to-cart"),m&&"false"==u&&n.cart.clear_cart(),s||(s=c),i&&r&&o&&c&&s){var l=new e(r,i,c,s,d,o);n.cart.add_item_to_cart(l)}m&&(t.location="/checkout?cart="+t.localStorage.getItem("omp_cart_id"))};this.add_to_cart_btns.forEach((t=>{t.addEventListener("click",a)})),this.checkout_btns.forEach((t=>{t.addEventListener("click",a)}))}get_meta(t){const e=document.getElementsByTagName("meta");for(let n=0;n<e.length;n++)if(e[n].getAttribute("name")===t)return e[n].getAttribute("content");return""}load_page_key(){localStorage.setItem("omp_key",this.get_meta("omp_key"))}load_page_title(){localStorage.getItem("omp_title")||localStorage.setItem("omp_title",document.title)}parse_query_string(t){for(var e=t.split("&"),n={},a=0;a<e.length;a++){var i=e[a].split("="),r=decodeURIComponent(i[0]),o=decodeURIComponent(i[1]);if(void 0===n[r])n[r]=decodeURIComponent(o);else if("string"==typeof n[r]){var c=[n[r],decodeURIComponent(o)];n[r]=c}else n[r].push(decodeURIComponent(o))}return n}getLocation(t){var e=t.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);return e&&{href:t,protocol:e[1],host:e[2],hostname:e[3],port:e[4],pathname:e[5],search:e[6],hash:e[7]}}load_referral(){var t=document.referrer;t&&(localStorage.setItem("referral_url",t),localStorage.setItem("referral_host",this.getLocation(t).hostname))}load_utm_tag(){var e={};try{e=JSON.parse(localStorage.getItem("utm_tag")||"{}")}catch(t){console.log(e)}var n=t.location.search.substring(1),a=this.parse_query_string(n),i={};a.utm_source&&(i.utm_source=a.utm_source),a.utm_medium&&(i.utm_medium=a.utm_medium),a.utm_campaign&&(i.utm_campaign=a.utm_campaign),a.utm_term&&(i.utm_term=a.utm_term),a.utm_content&&(i.utm_content=a.utm_content),i=Object.assign(i,e),localStorage.setItem("utm_tag",JSON.stringify(i))}update_cart_view_by_sku(t){var e=this.cart.find(t);if(e){var n=document.getElementById("omp-cart-quantity-input-"+t),a=document.getElementById("omp-cart-price-"+t);n.value=e.quantity,a.innerHTML=(e.quantity*e.discounted_price).toLocaleString()+" VND"}else this.remove_item(t)}remove_item(t){this.cart.remove_item(t);var e=document.getElementById("omp-cart-row-"+t);e&&e.remove(),this.render_popup()}set_quantity(t,e){this.cart.set_quantity(t,parseInt(e)),this.update_cart_view_by_sku(t)}increase_quantity(t,e=1){this.cart.increase_sku_quantity(t,e),this.update_cart_view_by_sku(t)}decrease_quantity(t,e=1){this.cart.decrease_sku_quantity(t,e),this.update_cart_view_by_sku(t)}}}(window);var cart=new Cart,omipage=new Omipage(cart);omipage.binding_add_to_cart_button(),omipage.binding_cart_quantity();
